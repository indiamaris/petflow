{"ast":null,"code":"var _jsxFileName = \"/Users/indiamaris/CODE/petflow/src/components/FlowCanvas.js\",\n  _s = $RefreshSig$();\nimport React, { useCallback, useRef, useState, useEffect } from 'react';\nimport { ReactFlow, addEdge, Controls, Background, MiniMap } from '@xyflow/react';\nimport '@xyflow/react/dist/style.css';\nimport './FlowCanvas.css';\nimport CustomNode from './CustomNode';\nimport { FLOW_CONFIG } from '../config/flow-config';\nimport AnimalDetailsPanel from './AnimalDetailsPanel';\nimport ContextMenu from './ContextMenu';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst nodeTypes = {\n  custom: CustomNode\n};\nfunction FlowCanvas({\n  nodes: initialNodes,\n  edges: initialEdges,\n  onUpdate,\n  onGranjaClick,\n  onAnimalUpdate,\n  canvasId\n}) {\n  _s();\n  const [nodes, setNodes] = useState(initialNodes);\n  const [edges, setEdges] = useState(initialEdges);\n  const [selectedAnimal, setSelectedAnimal] = useState(null);\n  const [isDetailsPanelOpen, setIsDetailsPanelOpen] = useState(false);\n  const reactFlowWrapper = useRef(null);\n  const onNodesChange = useCallback(changes => {\n    setNodes(nds => {\n      let updatedNodes = [...nds];\n      changes.forEach(change => {\n        if (change.type === 'position') {\n          updatedNodes = updatedNodes.map(node => node.id === change.id ? {\n            ...node,\n            position: change.position\n          } : node);\n        } else if (change.type === 'remove') {\n          updatedNodes = updatedNodes.filter(node => node.id !== change.id);\n        } else if (change.type === 'add') {\n          updatedNodes = [...updatedNodes, change.item];\n        }\n      });\n      return updatedNodes;\n    });\n  }, []);\n  const onEdgesChange = useCallback(changes => {\n    setEdges(eds => {\n      let updatedEdges = [...eds];\n      changes.forEach(change => {\n        if (change.type === 'remove') {\n          updatedEdges = updatedEdges.filter(edge => edge.id !== change.id);\n        } else if (change.type === 'add') {\n          updatedEdges = [...updatedEdges, change.item];\n        }\n      });\n      return updatedEdges;\n    });\n  }, []);\n  const onConnect = useCallback(params => {\n    setEdges(eds => addEdge(params, eds));\n  }, []);\n  const onNodeClick = useCallback((event, node) => {\n    console.log('Node clicked:', node);\n    if (node.data.type === 'granja') {\n      onGranjaClick(node.id);\n    } else if (node.data.type === 'animal') {\n      setSelectedAnimal(node);\n      setIsDetailsPanelOpen(true);\n    }\n  }, [onGranjaClick]);\n\n  // Atualizar o estado global quando os nós ou edges mudarem\n  useEffect(() => {\n    onUpdate(nodes, edges);\n  }, [nodes, edges, onUpdate]);\n\n  // Sincronizar com as mudanças externas apenas na primeira renderização\n  useEffect(() => {\n    setNodes(initialNodes);\n    setEdges(initialEdges);\n  }, []); // Array vazio para executar apenas uma vez\n\n  const handleSaveAnimal = useCallback((animalId, animalData) => {\n    // Atualizar o estado local\n    setNodes(prevNodes => prevNodes.map(node => node.id === animalId ? {\n      ...node,\n      data: {\n        ...node.data,\n        ...animalData\n      }\n    } : node));\n\n    // Atualizar o estado global\n    if (onAnimalUpdate) {\n      onAnimalUpdate(animalId, animalData);\n    }\n    setIsDetailsPanelOpen(false);\n    setSelectedAnimal(null);\n  }, [onAnimalUpdate]);\n  const handleCloseDetailsPanel = useCallback(() => {\n    setIsDetailsPanelOpen(false);\n    setSelectedAnimal(null);\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flow-canvas\",\n    ref: reactFlowWrapper,\n    children: [/*#__PURE__*/_jsxDEV(ReactFlow, {\n      nodes: nodes,\n      edges: edges,\n      onNodesChange: onNodesChange,\n      onEdgesChange: onEdgesChange,\n      onConnect: onConnect,\n      onNodeClick: onNodeClick,\n      nodeTypes: nodeTypes,\n      ...FLOW_CONFIG,\n      attributionPosition: \"bottom-left\",\n      children: [/*#__PURE__*/_jsxDEV(Controls, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Background, {\n        color: \"#aaa\",\n        gap: 16\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(MiniMap, {\n        nodeColor: node => {\n          switch (node.data.type) {\n            case 'granja':\n              return '#ff6b6b';\n            case 'animal':\n              return '#4ecdc4';\n            default:\n              return '#95a5a6';\n          }\n        },\n        nodeStrokeWidth: 3\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(AnimalDetailsPanel, {\n      animal: selectedAnimal,\n      isOpen: isDetailsPanelOpen,\n      onClose: handleCloseDetailsPanel,\n      onSave: handleSaveAnimal\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 118,\n    columnNumber: 5\n  }, this);\n}\n_s(FlowCanvas, \"i8p7UqUD0oP/Uy1kV2A0C1+jkk8=\");\n_c = FlowCanvas;\nexport default FlowCanvas;\nvar _c;\n$RefreshReg$(_c, \"FlowCanvas\");","map":{"version":3,"names":["React","useCallback","useRef","useState","useEffect","ReactFlow","addEdge","Controls","Background","MiniMap","CustomNode","FLOW_CONFIG","AnimalDetailsPanel","ContextMenu","jsxDEV","_jsxDEV","nodeTypes","custom","FlowCanvas","nodes","initialNodes","edges","initialEdges","onUpdate","onGranjaClick","onAnimalUpdate","canvasId","_s","setNodes","setEdges","selectedAnimal","setSelectedAnimal","isDetailsPanelOpen","setIsDetailsPanelOpen","reactFlowWrapper","onNodesChange","changes","nds","updatedNodes","forEach","change","type","map","node","id","position","filter","item","onEdgesChange","eds","updatedEdges","edge","onConnect","params","onNodeClick","event","console","log","data","handleSaveAnimal","animalId","animalData","prevNodes","handleCloseDetailsPanel","className","ref","children","attributionPosition","fileName","_jsxFileName","lineNumber","columnNumber","color","gap","nodeColor","nodeStrokeWidth","animal","isOpen","onClose","onSave","_c","$RefreshReg$"],"sources":["/Users/indiamaris/CODE/petflow/src/components/FlowCanvas.js"],"sourcesContent":["import React, { useCallback, useRef, useState, useEffect } from 'react';\nimport {\n  ReactFlow,\n  addEdge,\n  Controls,\n  Background,\n  MiniMap\n} from '@xyflow/react';\nimport '@xyflow/react/dist/style.css';\nimport './FlowCanvas.css';\nimport CustomNode from './CustomNode';\nimport { FLOW_CONFIG } from '../config/flow-config';\nimport AnimalDetailsPanel from './AnimalDetailsPanel';\nimport ContextMenu from './ContextMenu';\n\nconst nodeTypes = {\n  custom: CustomNode\n};\n\nfunction FlowCanvas({ nodes: initialNodes, edges: initialEdges, onUpdate, onGranjaClick, onAnimalUpdate, canvasId }) {\n  const [nodes, setNodes] = useState(initialNodes);\n  const [edges, setEdges] = useState(initialEdges);\n  const [selectedAnimal, setSelectedAnimal] = useState(null);\n  const [isDetailsPanelOpen, setIsDetailsPanelOpen] = useState(false);\n  const reactFlowWrapper = useRef(null);\n\n  const onNodesChange = useCallback((changes) => {\n    setNodes((nds) => {\n      let updatedNodes = [...nds];\n      \n      changes.forEach(change => {\n        if (change.type === 'position') {\n          updatedNodes = updatedNodes.map(node => \n            node.id === change.id \n              ? { ...node, position: change.position }\n              : node\n          );\n        } else if (change.type === 'remove') {\n          updatedNodes = updatedNodes.filter(node => node.id !== change.id);\n        } else if (change.type === 'add') {\n          updatedNodes = [...updatedNodes, change.item];\n        }\n      });\n      \n      return updatedNodes;\n    });\n  }, []);\n\n  const onEdgesChange = useCallback((changes) => {\n    setEdges((eds) => {\n      let updatedEdges = [...eds];\n      \n      changes.forEach(change => {\n        if (change.type === 'remove') {\n          updatedEdges = updatedEdges.filter(edge => edge.id !== change.id);\n        } else if (change.type === 'add') {\n          updatedEdges = [...updatedEdges, change.item];\n        }\n      });\n      \n      return updatedEdges;\n    });\n  }, []);\n\n  const onConnect = useCallback(\n    (params) => {\n      setEdges((eds) => addEdge(params, eds));\n    },\n    []\n  );\n\n  const onNodeClick = useCallback((event, node) => {\n    console.log('Node clicked:', node);\n    if (node.data.type === 'granja') {\n      onGranjaClick(node.id);\n    } else if (node.data.type === 'animal') {\n      setSelectedAnimal(node);\n      setIsDetailsPanelOpen(true);\n    }\n  }, [onGranjaClick]);\n\n  // Atualizar o estado global quando os nós ou edges mudarem\n  useEffect(() => {\n    onUpdate(nodes, edges);\n  }, [nodes, edges, onUpdate]);\n\n  // Sincronizar com as mudanças externas apenas na primeira renderização\n  useEffect(() => {\n    setNodes(initialNodes);\n    setEdges(initialEdges);\n  }, []); // Array vazio para executar apenas uma vez\n\n  const handleSaveAnimal = useCallback((animalId, animalData) => {\n    // Atualizar o estado local\n    setNodes(prevNodes => \n      prevNodes.map(node => \n        node.id === animalId \n          ? { ...node, data: { ...node.data, ...animalData } }\n          : node\n      )\n    );\n    \n    // Atualizar o estado global\n    if (onAnimalUpdate) {\n      onAnimalUpdate(animalId, animalData);\n    }\n    \n    setIsDetailsPanelOpen(false);\n    setSelectedAnimal(null);\n  }, [onAnimalUpdate]);\n\n  const handleCloseDetailsPanel = useCallback(() => {\n    setIsDetailsPanelOpen(false);\n    setSelectedAnimal(null);\n  }, []);\n\n  return (\n    <div className=\"flow-canvas\" ref={reactFlowWrapper}>\n      <ReactFlow\n        nodes={nodes}\n        edges={edges}\n        onNodesChange={onNodesChange}\n        onEdgesChange={onEdgesChange}\n        onConnect={onConnect}\n        onNodeClick={onNodeClick}\n        nodeTypes={nodeTypes}\n        {...FLOW_CONFIG}\n        attributionPosition=\"bottom-left\"\n      >\n        <Controls />\n        <Background color=\"#aaa\" gap={16} />\n        <MiniMap\n          nodeColor={(node) => {\n            switch (node.data.type) {\n              case 'granja':\n                return '#ff6b6b';\n              case 'animal':\n                return '#4ecdc4';\n              default:\n                return '#95a5a6';\n            }\n          }}\n          nodeStrokeWidth={3}\n        />\n      </ReactFlow>\n      \n      <AnimalDetailsPanel\n        animal={selectedAnimal}\n        isOpen={isDetailsPanelOpen}\n        onClose={handleCloseDetailsPanel}\n        onSave={handleSaveAnimal}\n      />\n    </div>\n  );\n}\n\nexport default FlowCanvas;\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,WAAW,EAAEC,MAAM,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AACvE,SACEC,SAAS,EACTC,OAAO,EACPC,QAAQ,EACRC,UAAU,EACVC,OAAO,QACF,eAAe;AACtB,OAAO,8BAA8B;AACrC,OAAO,kBAAkB;AACzB,OAAOC,UAAU,MAAM,cAAc;AACrC,SAASC,WAAW,QAAQ,uBAAuB;AACnD,OAAOC,kBAAkB,MAAM,sBAAsB;AACrD,OAAOC,WAAW,MAAM,eAAe;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAExC,MAAMC,SAAS,GAAG;EAChBC,MAAM,EAAEP;AACV,CAAC;AAED,SAASQ,UAAUA,CAAC;EAAEC,KAAK,EAAEC,YAAY;EAAEC,KAAK,EAAEC,YAAY;EAAEC,QAAQ;EAAEC,aAAa;EAAEC,cAAc;EAAEC;AAAS,CAAC,EAAE;EAAAC,EAAA;EACnH,MAAM,CAACR,KAAK,EAAES,QAAQ,CAAC,GAAGzB,QAAQ,CAACiB,YAAY,CAAC;EAChD,MAAM,CAACC,KAAK,EAAEQ,QAAQ,CAAC,GAAG1B,QAAQ,CAACmB,YAAY,CAAC;EAChD,MAAM,CAACQ,cAAc,EAAEC,iBAAiB,CAAC,GAAG5B,QAAQ,CAAC,IAAI,CAAC;EAC1D,MAAM,CAAC6B,kBAAkB,EAAEC,qBAAqB,CAAC,GAAG9B,QAAQ,CAAC,KAAK,CAAC;EACnE,MAAM+B,gBAAgB,GAAGhC,MAAM,CAAC,IAAI,CAAC;EAErC,MAAMiC,aAAa,GAAGlC,WAAW,CAAEmC,OAAO,IAAK;IAC7CR,QAAQ,CAAES,GAAG,IAAK;MAChB,IAAIC,YAAY,GAAG,CAAC,GAAGD,GAAG,CAAC;MAE3BD,OAAO,CAACG,OAAO,CAACC,MAAM,IAAI;QACxB,IAAIA,MAAM,CAACC,IAAI,KAAK,UAAU,EAAE;UAC9BH,YAAY,GAAGA,YAAY,CAACI,GAAG,CAACC,IAAI,IAClCA,IAAI,CAACC,EAAE,KAAKJ,MAAM,CAACI,EAAE,GACjB;YAAE,GAAGD,IAAI;YAAEE,QAAQ,EAAEL,MAAM,CAACK;UAAS,CAAC,GACtCF,IACN,CAAC;QACH,CAAC,MAAM,IAAIH,MAAM,CAACC,IAAI,KAAK,QAAQ,EAAE;UACnCH,YAAY,GAAGA,YAAY,CAACQ,MAAM,CAACH,IAAI,IAAIA,IAAI,CAACC,EAAE,KAAKJ,MAAM,CAACI,EAAE,CAAC;QACnE,CAAC,MAAM,IAAIJ,MAAM,CAACC,IAAI,KAAK,KAAK,EAAE;UAChCH,YAAY,GAAG,CAAC,GAAGA,YAAY,EAAEE,MAAM,CAACO,IAAI,CAAC;QAC/C;MACF,CAAC,CAAC;MAEF,OAAOT,YAAY;IACrB,CAAC,CAAC;EACJ,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMU,aAAa,GAAG/C,WAAW,CAAEmC,OAAO,IAAK;IAC7CP,QAAQ,CAAEoB,GAAG,IAAK;MAChB,IAAIC,YAAY,GAAG,CAAC,GAAGD,GAAG,CAAC;MAE3Bb,OAAO,CAACG,OAAO,CAACC,MAAM,IAAI;QACxB,IAAIA,MAAM,CAACC,IAAI,KAAK,QAAQ,EAAE;UAC5BS,YAAY,GAAGA,YAAY,CAACJ,MAAM,CAACK,IAAI,IAAIA,IAAI,CAACP,EAAE,KAAKJ,MAAM,CAACI,EAAE,CAAC;QACnE,CAAC,MAAM,IAAIJ,MAAM,CAACC,IAAI,KAAK,KAAK,EAAE;UAChCS,YAAY,GAAG,CAAC,GAAGA,YAAY,EAAEV,MAAM,CAACO,IAAI,CAAC;QAC/C;MACF,CAAC,CAAC;MAEF,OAAOG,YAAY;IACrB,CAAC,CAAC;EACJ,CAAC,EAAE,EAAE,CAAC;EAEN,MAAME,SAAS,GAAGnD,WAAW,CAC1BoD,MAAM,IAAK;IACVxB,QAAQ,CAAEoB,GAAG,IAAK3C,OAAO,CAAC+C,MAAM,EAAEJ,GAAG,CAAC,CAAC;EACzC,CAAC,EACD,EACF,CAAC;EAED,MAAMK,WAAW,GAAGrD,WAAW,CAAC,CAACsD,KAAK,EAAEZ,IAAI,KAAK;IAC/Ca,OAAO,CAACC,GAAG,CAAC,eAAe,EAAEd,IAAI,CAAC;IAClC,IAAIA,IAAI,CAACe,IAAI,CAACjB,IAAI,KAAK,QAAQ,EAAE;MAC/BjB,aAAa,CAACmB,IAAI,CAACC,EAAE,CAAC;IACxB,CAAC,MAAM,IAAID,IAAI,CAACe,IAAI,CAACjB,IAAI,KAAK,QAAQ,EAAE;MACtCV,iBAAiB,CAACY,IAAI,CAAC;MACvBV,qBAAqB,CAAC,IAAI,CAAC;IAC7B;EACF,CAAC,EAAE,CAACT,aAAa,CAAC,CAAC;;EAEnB;EACApB,SAAS,CAAC,MAAM;IACdmB,QAAQ,CAACJ,KAAK,EAAEE,KAAK,CAAC;EACxB,CAAC,EAAE,CAACF,KAAK,EAAEE,KAAK,EAAEE,QAAQ,CAAC,CAAC;;EAE5B;EACAnB,SAAS,CAAC,MAAM;IACdwB,QAAQ,CAACR,YAAY,CAAC;IACtBS,QAAQ,CAACP,YAAY,CAAC;EACxB,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;;EAER,MAAMqC,gBAAgB,GAAG1D,WAAW,CAAC,CAAC2D,QAAQ,EAAEC,UAAU,KAAK;IAC7D;IACAjC,QAAQ,CAACkC,SAAS,IAChBA,SAAS,CAACpB,GAAG,CAACC,IAAI,IAChBA,IAAI,CAACC,EAAE,KAAKgB,QAAQ,GAChB;MAAE,GAAGjB,IAAI;MAAEe,IAAI,EAAE;QAAE,GAAGf,IAAI,CAACe,IAAI;QAAE,GAAGG;MAAW;IAAE,CAAC,GAClDlB,IACN,CACF,CAAC;;IAED;IACA,IAAIlB,cAAc,EAAE;MAClBA,cAAc,CAACmC,QAAQ,EAAEC,UAAU,CAAC;IACtC;IAEA5B,qBAAqB,CAAC,KAAK,CAAC;IAC5BF,iBAAiB,CAAC,IAAI,CAAC;EACzB,CAAC,EAAE,CAACN,cAAc,CAAC,CAAC;EAEpB,MAAMsC,uBAAuB,GAAG9D,WAAW,CAAC,MAAM;IAChDgC,qBAAqB,CAAC,KAAK,CAAC;IAC5BF,iBAAiB,CAAC,IAAI,CAAC;EACzB,CAAC,EAAE,EAAE,CAAC;EAEN,oBACEhB,OAAA;IAAKiD,SAAS,EAAC,aAAa;IAACC,GAAG,EAAE/B,gBAAiB;IAAAgC,QAAA,gBACjDnD,OAAA,CAACV,SAAS;MACRc,KAAK,EAAEA,KAAM;MACbE,KAAK,EAAEA,KAAM;MACbc,aAAa,EAAEA,aAAc;MAC7Ba,aAAa,EAAEA,aAAc;MAC7BI,SAAS,EAAEA,SAAU;MACrBE,WAAW,EAAEA,WAAY;MACzBtC,SAAS,EAAEA,SAAU;MAAA,GACjBL,WAAW;MACfwD,mBAAmB,EAAC,aAAa;MAAAD,QAAA,gBAEjCnD,OAAA,CAACR,QAAQ;QAAA6D,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,eACZxD,OAAA,CAACP,UAAU;QAACgE,KAAK,EAAC,MAAM;QAACC,GAAG,EAAE;MAAG;QAAAL,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,eACpCxD,OAAA,CAACN,OAAO;QACNiE,SAAS,EAAG/B,IAAI,IAAK;UACnB,QAAQA,IAAI,CAACe,IAAI,CAACjB,IAAI;YACpB,KAAK,QAAQ;cACX,OAAO,SAAS;YAClB,KAAK,QAAQ;cACX,OAAO,SAAS;YAClB;cACE,OAAO,SAAS;UACpB;QACF,CAAE;QACFkC,eAAe,EAAE;MAAE;QAAAP,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACpB,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACO,CAAC,eAEZxD,OAAA,CAACH,kBAAkB;MACjBgE,MAAM,EAAE9C,cAAe;MACvB+C,MAAM,EAAE7C,kBAAmB;MAC3B8C,OAAO,EAAEf,uBAAwB;MACjCgB,MAAM,EAAEpB;IAAiB;MAAAS,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC1B,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACC,CAAC;AAEV;AAAC5C,EAAA,CAvIQT,UAAU;AAAA8D,EAAA,GAAV9D,UAAU;AAyInB,eAAeA,UAAU;AAAC,IAAA8D,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}